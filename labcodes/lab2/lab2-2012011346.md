# 操作系统Lab2实验报告
计24 田博 2012011346

## 练习1：实现 first-fit 连续物理内存分配算法
基本按照文件开头的大段注释实现。

基本就是链表的插入、删除，需要注意的是要保证操作以后的有序性。

代码中采用链表这种结构，每次都需要遍历。可以采用平衡树进行快速的有序插入和删除。

## 练习2：实现寻找虚拟地址对应的页表项
### PDE和PTE
1. Page Directory是一个大数组，存储每个PDE。PDE实际上就是一个指针(31~12，补0)和一些FLAGS(11~0)，高位指向一个存储PTE的数组，FLAGS用于访问控制。
2. PTE的高位(31~12，补0)对应物理地址，低位的FLAGS与PDE类似，提供更更细致（更小块内存）的权限控制

### 页访问异常
1. 触发中断
2. 检测异常类型，进行换页等操作，或者报告错误

## 练习3：释放某虚地址所在的页并取消对应二级页表项的映射
### 设计实现
1. 检查PTE是否有效
2. 找到PTE对应的页，页引用数减一，如果引用为0则释放页
3. PTE清零
4. 使TLB中的地址对应的页表缓存无效

### Pages与PTE和PDE的对应关系
有关系。PTE或PDE的31~12位补零对应物理地址高位，不补零对应物理地址的Page编号，即Pages中的下标。

### 虚拟地址与物理地址相等
1. 段机制，修改GDT使得短偏移为0，这样线性地址等于虚拟地址
2. 页机制，页的线性地址等于物理地址

## 和答案区别
1. 答案中似乎在init的时候把所有的page都插入的链表，而我在实现是只插入block中第一个page
2. 所以在alloc时，答案把连续的block分配后，还需要把第一个page之后的page也删除
3. 同样的，free的时候答案插入了多个page
4. 总体来看，即使只插入第一个page，也不影响内存分配，并且优化了链表查找的速度。不是很明白答案插入所有的page的用意。

## 知识点
1. 段机制与页机制
2. 页表的结构
3. CPU中提供的控制内存管理的指令和寄存器
4. 分页算法