# 操作系统Lab4实验报告
计24 田博 2012011346

## 练习1：分配并初始化一个进程控制块
1. 调用kmalloc分配proc_struct
2. state、pid、cr3需要特殊处理，其余初始化为0，memset即可

context保存了进程切换时proc的寄存器，tf保存了程序的段信息、栈信息，以及中断时的中断信息

## 练习2：为新创建的内核线程分配资源
###设计实现
1. 调用alloc_proc，首先获得一块用户信息块。
2. 为进程分配一个内核栈。
3. 复制原进程的内存管理信息到新进程（但内核线程不必做此事）
4. 复制原进程上下文到新进程
5. 将新进程添加到进程列表
6. 唤醒新进程
7. 返回新进程号

当前进程中唯一，操作系统的整个生命周期不唯一，在get_pid中会循环使用pid，耗尽会等待

##练习3：阅读代码，理解 proc_run 函数和它调用的函数如何完成进程切换的
2个内核线程

1. idleproc 当需要调度时，调用schedule
2. init_main 运行用户程序

local_intr_save/restore相当于一个锁，保护临界区，因为进程切换的时候被打断会造成系统不正常

## 和答案区别
1. 我的程序中proc初始化memset清零，答案中手动清零
2. 答案中处理了do_fork中的临界区

## 知识点
1. 用户进程的启动、调度、退出
2. 用户进程资源的管理
3. 用户进程与操作系统的交互